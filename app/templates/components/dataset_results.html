{# templates/components/dataset_results.html #}
{% import 'components/dataset_card.j2' as dataset_card -%}
{% if datasets %}
  {% set result_start = result_start_index if result_start_index is defined else 1 %}
  {% for dataset in datasets %}
    {% set result_number = result_start + loop.index0 %}
    {% if from_hint %}
      {{ dataset_card.dataset_card(dataset, from_hint=from_hint, result_number=result_number) }}
    {% else %}
      {{ dataset_card.dataset_card(dataset, result_number=result_number) }}
    {% endif %}

  {% endfor %}
    {% if after %}
    <div id="replaceMe">
    {% set new_results = results_hint + per_page %}
    <button class="usa-button margin-top-2"
        {% if from_hint %}
          hx-get="{{ url_for('main.search', 
              q=query, 
              per_page=per_page, 
              after=after, 
              results=new_results,
              sort=sort_by,
              org_slug=org_slug,
              org_type=org_types,
              keyword=keywords,
              spatial_filter=spatial_filter,
              spatial_geometry=spatial_geometry|tojson if spatial_geometry else none,
              spatial_within=spatial_within if spatial_geometry else none,
              from_hint=from_hint
          ) }}"
        {% else %}
          hx-get="{{ url_for('main.search', 
              q=query, 
              per_page=per_page, 
              after=after, 
              results=new_results,
              sort=sort_by,
              org_slug=org_slug,
              org_type=org_types,
              keyword=keywords,
              spatial_filter=spatial_filter,
              spatial_geometry=spatial_geometry|tojson if spatial_geometry else none,
              spatial_within=spatial_within if spatial_geometry else none,
          ) }}"
        {% endif %}
        hx-target="#replaceMe"
        hx-swap="outerHTML"
        hx-push-url="{{ url_for('main.index', 
            q=query, 
            results=new_results,
            sort=sort_by,
            org_slug=org_slug,
            org_type=org_types,
            keyword=keywords,
            spatial_filter=spatial_filter,
            spatial_geometry=spatial_geometry|tojson if spatial_geometry else none,
            spatial_within=spatial_within if spatial_geometry else none,
        ) }}"
        hx-trigger="click">
        Show more results
    </button>
    <button class="usa-button usa-button--outline" onClick="window.scrollTo({top: 0, behavior: 'smooth'});">Return to top</button> 
    </div>
    {% endif %}
{% endif %}
