---
applications:
  - name: ((app_name))-proxy
    buildpacks:
      - https://github.com/cloudfoundry/nginx-buildpack
    services:
      - ((app_name))-s3
      - ((app_name))-secrets
    path: ./proxy
    # TODO: tweak with load testing
    memory: 100M
    instances: ((proxy_instances))
    routes:
      - route: ((route_external))
    env:
      EXTERNAL_ROUTE: ((route_external))
      INTERNAL_ROUTE: ((route_internal))
      BASIC_AUTH_ENABLED: ((basic_auth_enabled))
  - name: ((app_name))
    buildpacks:
      - python_buildpack
    routes:
      - route: ((route_internal))
    services:
      - datagov-harvest-db
      - ((app_name))-secrets
      - ((app_name))-s3
      - ((app_name))-opensearch
    instances: ((instances))
    memory: 1G
    disk_quota: 2G
    env:
      FLASK_APP: run.py
      NEW_RELIC_APP_NAME: ((new_relic_app_name))
      NEW_RELIC_HOST: gov-collector.newrelic.com
      NEW_RELIC_MONITOR_MODE: ((new_relic_monitor_mode))
      NEW_RELIC_CONFIG_FILE: /home/vcap/app/config/newrelic.ini
      SITE_URL: ((site_url))
    command: ./app-start.sh
